##### TUGAS 2 PKSJ
# Penetration Testing : SQL Injection
## Pendahuluan
SQL (Structured Query Language) merupakan suatu bahasa (language) yang digunakan untuk mengakses data di dalam sebuah database relasional. 
SQL sering juga disebut dengan istilah query, dan bahasa SQL secara praktiknya digunakan sebagai bahasa standar untuk manajemen database 
relasional. Hingga saat ini hampir seluruh server database atau software database mengenal dan mengerti bahasa SQL.
Karena database merupakan asset yang vital dan rawan untuk diserang maka penting untuk menjaga keamanan dari database tersebut.
Salah satu celah yang bisa digunakan oleh penyerang untuk mengakses database adalah melalui SQL Injection.
SQL injection adalah sebuah aksi hacking yang dilakukan di aplikasi client dengan cara memodifikasi perintah SQL yang ada di memori aplikasi client.
Tidak adanya penanganan terhadap karakter – karakter tanda petik satu ‟ dan juga karakter double minus -- yang menyebabkan suatu aplikasi dapat disisipi
dengan perintah SQL. Sehingga seorang Hacker menyisipkan perintah SQL kedalam suatu parameter maupun suatu form.

Dalam simulasi kali ini akan dilakukan percobaan simulasi SQL injection pada plugin wordpress yang vurnerable menggunakan sqlmap dan WPscan.

###### Anggota Kelompok :
| Nama        | NRP         |
|:-------------:|:-----:|
M Rasyid Karomi  |  5114100101
Miftakhul Akhyar |  5114100143
Faiq Firdausi    |  5114100165

## Dasar Teori
### Operating System
Sistem operasi (Operation System) adalah perangkat lunak (software) yang mengatur seluruh sumber daya dalam komputer.
Sistem operasi menjadi salah satu aspek penting dalam keamanan jaringan termasuk didalamnya kestabilan system, vurnerability dan 
ketersediaan tools keamanan pada operating system.
Pada pengujian ini akan digunakan dua Operating System yaitu Ubuntu Server dan Kali Linux.

#### Ubuntu Server
Linux Ubuntu Server adalah system operasi turunan dari Linux Ubuntu yang di desain khusus dengan kernel 
yang telah dikustomisasi untuk bekerja sebagai system operasi server. Kernel Linux Ubuntu Server di desain 
khusus untuk bisa bekerja dengan lebih dari satu proses (multiprocessor) dan menggunakan pennjadwalan deadline I/O.
Ubuntu Server dipilih untuk simulasi penetration testing karena Ubuntu Server memiliki lisensi open source dan merupakan
distro yang banyak digunakan untuk server serta merupakan turunan dari distro linux debian sehingga memiliki 
keamanan yang cukup tinggi. 

#### Kali Linux
Kali Linux adalah distribusi berlandasan distribusi Debian GNU/Linux untuk tujuan forensik digital dan di gunakan untuk pengujian 
penetrasi, yang dipelihara dan didanai oleh Offensive Security. Kali juga dikembangkan oleh  Offensive Security sebagai penerus BackTrack
Linux. Kali menyediakan pengguna akses yang mudah terhadap koleksi tools yang lengkap dan komprehensif untuk pengujian keamanan atau penetration testing.
Hal tersebut menjadi dasar memilih distro ini untuk digunakan sebagai OS penetration tester pada simulasi ini. Kali merupakan platform yang 
mendukung Metasploit Framework dari Proyek Metasploit, berupa alat untuk mengembangkan dan melaksanakan kode eksploit terhadap <i>remote host</i>. 
Distro ini juga menyertakan tools keamanan yang lengkap termasuk Wireshark, Ncrack, medusa, Nmap dan Aircrack-ng.

### Wordpress
WordPress adalah sebuah aplikasi sumber terbuka (open source) yang sangat populer digunakan sebagai mesin blog (blog engine). WordPress dibangun dengan bahasa pemrograman PHP dan basis data (database) MySQL. PHP dan MySQL, keduanya merupakan perangkat lunak sumber terbuka (open source software). Selain sebagai blog, WordPress juga mulai digunakan sebagai sebuah CMS (Content Management System) karena kemampuannya yang dapat dimodifikasi dan disesuaikan dengan kebutuhan penggunanya.

#### Video Player 1.5.16
Merupakan plugin Wordpress untuk menambahkan, mengatur dan menampilkan video.

###### Vulnerability
Celah keamanan wordpress ini terletak pada fungsi `show_tag()`, `spider_video_select_playlist()`, `spider_video_select_video()`.
```php
show_tag():
 
[...]
    
if (isset($_POST['page_number'])) {
   if ($_POST['asc_or_desc']) {
      $sort["sortid_by"] = esc_sql(esc_html(stripslashes($_POST['order_by'])));
      if ($_POST['asc_or_desc'] == 1) {
         $sort["custom_style"] = "manage-column column-title sorted asc";
         $sort["1_or_2"] = "2";
         $order = "ORDER BY " . $sort["sortid_by"] . " ASC";
      } else {
         $sort["custom_style"] = "manage-column column-title sorted desc";
         $sort["1_or_2"] = "1";
         $order = "ORDER BY " . $sort["sortid_by"] . " DESC";
      }
   }
 
 
spider_video_select_playlist():
[...]
if(isset($_POST['page_number']))
{
   if($_POST['asc_or_desc'])
   {
      $sort["sortid_by"]=esc_sql(esc_html(stripslashes($_POST['order_by'])));
      if($_POST['asc_or_desc']==1)
      {
         $sort["custom_style"]="manage-column column-title sorted asc";
         $sort["1_or_2"]="2";
         $order="ORDER BY ".$sort["sortid_by"]." ASC";
      }
      else
      {
         $sort["custom_style"]="manage-column column-title sorted desc";
         $sort["1_or_2"]="1";
         $order="ORDER BY ".$sort["sortid_by"]." DESC";
      }
   }
function spider_video_select_video():
 
[...]
    
if(isset($_POST['page_number']))
{
      if($_POST['asc_or_desc'])
      {
         $sort["sortid_by"]=esc_html(stripslashes($_POST['order_by']));
         if($_POST['asc_or_desc']==1)
         {
            $sort["custom_style"]="manage-column column-title sorted asc";
            $sort["1_or_2"]="2";
            $order="ORDER BY ".esc_sql($sort["sortid_by"])." ASC";
         }
         else
         {
            $sort["custom_style"]="manage-column column-title sorted desc";
            $sort["1_or_2"]="1";
            $order="ORDER BY ".esc_sql($sort["sortid_by"])." DESC";
         }
      }
}
```

Developer mencoba mengatisipasi SQL Injection dengan menggunakan `esc_sql` namun nilai input post digunakan pada klausal `ORDER_BY` yang penggunaannya tanpa menggunakan tanda kutip sehingga memungkinkan untuk menyisipkan perintah query walaupun sudah diantisipasi dengan `esc_sql`.

###### Kode Pada User Input
```html
<html>
   <body>
      <form action="http://<target>/wp-admin/admin-ajax.php?action=spiderVeideoPlayerselectplaylist" method="POST">
         <input type="hidden" name="search_events_by_title" value="" />
         <input type="hidden" name="page_number" value="0" />
         <input type="hidden" name="serch_or_not" value="" />
         <input type="hidden" name="asc_or_desc" value="1" />
         <input type="hidden" name="order_by" value="(CASE WHEN (SELECT sleep(10)) = 1 THEN id ELSE title END) ASC #" />
         <input type="hidden" name="option" value="com_Spider_Video_Player" />
         <input type="hidden" name="task" value="select_playlist" />
         <input type="hidden" name="boxchecked" value="0" />
         <input type="hidden" name="filter_order_playlist" value="" />
         <input type="hidden" name="filter_order_Dir_playlist" value="" />
         <input type="submit" value="Submit request" />
      </form>
   </body>
</html>
```

Link Plugin : [ [https://wordpress.org/plugins/player/developers/](https://wordpress.org/plugins/player/developers/) ]

#### League Manager 3.9.1.1
Merupakan plugin Wordpress untuk menampilkan dan memanajemen liga olahraga.

Link Plugin : [ [https://wordpress.org/plugins/leaguemanager/developers/](https://wordpress.org/plugins/leaguemanager/developers/) ]

#### CP Reservation Calendar 1.1.6
Merupakan plugin untuk melakukan reservasi berbasis kalender yang bisa digunakan untuk reservasi hotel, penyewaan mobil, penyewaan kantor jasa wisata dan lain sebagainya.

###### Vulnerability
Celah keamanan wordpress ini terletak pada file `dex_reservations.php`

```php
function dex_reservations_get_option ($field, $default_value)
{
    global $wpdb, $dex_option_buffered_item, $dex_option_buffered_id;
    if ($dex_option_buffered_id == CP_CALENDAR_ID)
        $value = $dex_option_buffered_item->$field;
    else
    {
       $myrows = $wpdb->get_results( "SELECT * FROM ".DEX_RESERVATIONS_CONFIG_TABLE_NAME." WHERE id=".CP_CALENDAR_ID );
       $value = $myrows[0]->$field;
       $dex_option_buffered_item = $myrows[0];
       $dex_option_buffered_id  = CP_CALENDAR_ID;
    }
    if ($value == '' && $dex_option_buffered_item->calendar_language == '')
        $value = $default_value;
    return $value;
}
```
Pada fungsi diatas variabel `CP_CALENDAR_ID` herusnya bernilai integer namun tidak ada fungsi atau blok kode untuk memvalidasi variabel tersebut.

Link Plugin : [ [https://wordpress.org/plugins/cp-reservation-calendar/](https://wordpress.org/plugins/cp-reservation-calendar/) ]

### Attacking Tools
#### mitmproxy
mitmproxy merupakan tool untuk melakukan intercept request proxy HTTP SSL berkemampuan interaktif, yang memungkinkan user untuk mengamati, memodifikasi dan memutar ulang request dan response dengan cepat.
#### WPScan
Merupakan tool berfungsi untuk memindai tingkat atau masalah keamanan dari CMS (Content Management System) Wordpress.
#### sqlmap
Merupakan tool opensource yang mendeteksi dan melakukan exploit pada bug SQL injection secara otomatis. dengan melakukan serangan SQL injection seorang attacker dapat mengambil alih serta memanipulasi sebuah database di dalam sebuah server. 
#### BBQsql
Merupakan framework Blind SQL Injection yang ditulis dalam bahasa python. BBQSQL juga merupakan alat semi otomatis, memungkinkan sedikit penyesuaian untuk yang sulit memicu temuan injeksi SQL. Memiliki UI yang intuitif untuk membuat serangan lebih mudah dilakukan. Python gevent juga diimplementasikan, membuat performa BBQSQL sangat cepat.

--------------
Jangan Lupa Screenshot
--------------
## Proses Instalasi
### Instalasi Objek Serangan
#### Instalasi Wordpress
#### Instalasi Video Player 1.5.16
#### Instalasi League Manager 3.9.1.1
#### Instalasi KittyCatfish 2.2
### Instalasi Attacking Tools
Karena tools WPscan, sqlmap dan BBQsql merupakan tools yang default sudah terinstall pada Kali Linux maka tidak diperlukan proses instalasi.
