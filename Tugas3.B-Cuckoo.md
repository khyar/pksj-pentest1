# Malware Analisys Mengunnakan Cuckoo
## Cuckoo

> Cuckoo adalah suatu framework analisis malware terotomatisasi yang dapat melakukan analisa perilaku dan menentukan jenis malware dengan menjalankan malware tersebut dalam sebuah sandbox yang dimonitoring activitinya. Cuckoo dapat  melakukan analisa pada berbagai jenis tipe file seperti : Executables Windows (EXE), file DLL, PDF, office document, halaman web, PHP, dll. 

> Cuckoo dapat menampilkan analisa dan melakukan trace terhadap API calls yang dijalankan proses yang terinfeksi malware, file apa saja yang diakses,dibuat,dihapus oleh malware, menyimpan memori dan network dumps dari proses malware.

### Instalasi Cuckoo
Dalam proses instalasi Cuckoo terdapat dua aktor yaitu Host dan Guest.
Host adalah OS yang akan melakukan analysis malware dan Guest adalah OS dimana malaware akan dicoba dijalankan atau sebagai target machine.

Pada pentest ini OS yagn digunakan sebagai Host adalah **Linux Mint 16.0 Petra** sedangkan OS yang digunakan sebagai Guest adalah **Windows XP SP3** yang dijalankan di VirtualBox.

#### Instalasi Pada Host OS
Pada Host OS akan diinstall Cuckoo yang berperan sebagai *Malware Analisys Tool*.

1. Install python & *pre-requirement library* 

Karena Cuckoo berjalan diatas python maka perlu diinstall *dependency* python, python-pip, python-dev dll.

```sh
$ sudo apt-get install python python-pip python-dev libffi-dev libssl-dev
$ sudo apt-get install python-virtualenv python-setuptools
$ sudo apt-get install libjpeg-dev zlib1g-dev swig
```
![install python](img-tugas3/cuckoo/30.png)

2. Mongo DB

Untuk menampilkan interface Web dari aplikasi Cuckoo diperlukan **mongodb**.
Proses instalasi mongodb.

```sh
$ sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 2930ADAE8CAF5059EE73BB4B58712A2291FA4AD5
$ echo "deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu xenial/mongodb-org/3.6 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-3.6.list
$ sudo apt-get update
$ sudo apt-get install -y mongodb-org
```
![install mongoDB](img-tugas3/cuckoo/mongo.png)

3. TCP Dump

```sh
$ apt-get install tcpdump
```

![install TCP Dump](img-tugas3/cuckoo/4.png)

Agar file dapat dibaca oleh akun selain root maka dijalankan perintah berikut.

```sh
$ sudo setcap cap_net_raw,cap_net_admin=eip /usr/sbin/tcpdump
$ sudo getcap /usr/sbin/tcpdump
```
![install TCP Dump](img-tugas3/cuckoo/5.png)

4. Yara

```sh
$ sudo apt-get install autoconf libtool libjansson-dev libmagic-dev libssl-dev -y
$ wget https://github.com/VirusTotal/yara/archive/v3.7.0.tar.gz -O yara-3.7.0.tar.gz
$ tar -zvxf yara-3.7.0.tar.gz 
$ cd yara-3.7.0/
$ ./bootstrap.sh
$ ./configure --with-crypto --enable-cuckoo --enable-magic
$ make && make install
```
![install Yara](img-tugas3/cuckoo/10.png)

5. PyDeep

ssdeep adalah sebuah program untuk menghitung dan mencocokkan Text Triggered Piecewise Hashing values.

```sh
$ wget https://github.com/ssdeep-project/ssdeep/releases/download/release-2.14/ssdeep-2.14.tar.gz
$ tar xvzf ssdeep-2.14.tar.gz
$ cd ssdeep-2.14/
$ ./configure && make && make install
```
![install SSDeep](img-tugas3/cuckoo/6.png)

![install PyDeep](img-tugas3/cuckoo/7.png)
![install PyDeep](img-tugas3/cuckoo/8.png)

6. Volatility

Volatility digunakan untuk melakukan analisa forensik terhadap memorydump.

```sh
$ git clone https://github.com/volatilityfoundation/volatility.git
$ cd volatility
$ python setup.py build
$ python setup.py install
$ python vol.py -h
```
![install Volatility](img-tugas3/cuckoo/14.png)

7. Install Cuckoo

```sh
$ pip download cuckoo
```
![Download Cuckoo](img-tugas3/cuckoo/31.png)

Akan mendownload dependency yang dibutuhkan oleh Cuckoo.
![Haisl Download](img-tugas3/cuckoo/32.png)
![Haisl Download](img-tugas3/cuckoo/33.png)
![Haisl Download](img-tugas3/cuckoo/34.png)

Install cuckoo dengan perintah sbb:
```sh
$ pip install Cuckoo-2.0.0.tar.gz
```
Untuk menginstall semua file .tar.gz gunakan perintah sbb:

```sh
$ pip install *.tar.gz
```

### Konfigurasi Cuckoo
##### cuckoo.conf
![cuckoo.conf](img-tugas3/cuckoo/conf1.png)
![cuckoo.conf](img-tugas3/cuckoo/conf2.png)
##### auxiliary.conf
![auxiliary.cond](img-tugas3/cuckoo/conf3.png)
##### virtualbox.conf
![virtualbox.cond](img-tugas3/cuckoo/conf5.png)
##### reporting.conf
![reporting.cond](img-tugas3/cuckoo/conf6.png)
##### routing.conf

### Instalasi & Konfigurasi Pada Guest OS

#### Install VirtualBox dan buat VM baru
Pada pentest ini VM yang digunakan adalah Windows XP Sp3
![WinXP](img-tugas3/cuckoo/18.png)
![WinXP](img-tugas3/cuckoo/19.png)

#### Menambahkan user
Tambahkan user yang akan melakukan testing ke grup user **vboxusers**

#### Menambahkan Host-Only Adapter
Tambahkan Host Only Adapter
![WinXP](img-tugas3/cuckoo/20.png)
![WinXP](img-tugas3/cuckoo/21.png)
#### Konfigurasi VM Windows XP
![Konfigurasi WinXP](img-tugas3/cuckoo/22.png)
#### Shared Folder
##### Install VirtualBox Guest Addition
![Shared Folder](img-tugas3/cuckoo/26.png)
![Shared Folder](img-tugas3/cuckoo/27.png)

![Shared Folder](img-tugas3/cuckoo/24.png)
![Shared Folder](img-tugas3/cuckoo/23.png)

![Shared Folder](img-tugas3/cuckoo/25.png)
![Shared Folder](img-tugas3/cuckoo/28.png)
![Shared Folder](img-tugas3/cuckoo/29.png)
#### Share Agen.py
![Share Agen](img-tugas3/cuckoo/copy.png)
![Share Agen](img-tugas3/cuckoo/nestat.png)
![Share Agen](img-tugas3/cuckoo/shared.png)
#### Install Python
![Install Python](img-tugas3/cuckoo/installpython.png)
#### Disable Firewall Guest
![Firewall](img-tugas3/cuckoo/firewall.png)
#### Konfigurasi firewall pada Host
![Firewall](img-tugas3/cuckoo/configip.png)
#### Tambahkan Snapshoot
![Snapshoot](img-tugas3/cuckoo/snapshoot.png)
### Menjalankan Cuckoo
![Cuckoo Start](img-tugas3/cuckoo/start.png)
#### Menjalankan web interface
![Web Interface Start](img-tugas3/cuckoo/webserver.png)
![Web Interface Start](img-tugas3/cuckoo/web.png)

#### Upload File untuk di analisa
![Web Interface Start](img-tugas3/cuckoo/analysis-GUI.png)
![Web Interface Start](img-tugas3/cuckoo/anaylisis-GUI.png)

![Web Interface Start](img-tugas3/cuckoo/cukco-running.png)
![Web Interface Start](img-tugas3/cuckoo/pending1.png)


